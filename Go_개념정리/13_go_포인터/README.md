# `Go` 포인터

- 포인터는 메모리 주소를 값으로 갖는 타입
  - 걍 간단하게 포인터인 변수가 선언되면 어떤 주소에 저장 될건데, 그 주소안의 값이 다른 변수의 주소가 들어있는거지
  - code
    ```go
    var a int
    var p *int
    // 내가 넣고 싶은 변수의 타입과 같은 타입에 포인터 이어야 한다.
    p = &a
    *p = 20
    // a = 20 이랑 같다
    // *p 는 상자임 근데 a의 주소값의 이름이 쓰여있는 상자
    // 그 상자 안에 20을 담는 거니까, a라는 상자에 20을 담는거지
    p := &a
    var p2 *int = &a
    var p3 **int = &p
    ```
- 여러 포인터가 하나의 변수를 가르킬 수 있다.
- 포인터 변수의 기본값은 nil(다른 언어의 null 과 같음)
  - nil: 유효하지 않은 값이라는 뜻
- 포인터의 사용 이유
  1. 같은 상자를 가리켜서 그 상자의 값을 바꿀 수 있다, 지역 함수 내부에서 다른 지역 변수를 바꿀 수 있는거다!
  2. 복사되는 사이즈에서 이득을 볼 수 있다!
  - code(1, 2 번 코드)
    ```go
    func ChangeData4(args *Data) {
        args.value = 100
        args.data[0] = 100
    }
    func main() {
        var data Data
        ChangeData4(&data)
        // 주소값이 아닌 data를 그대로 넣었다면
        // args에 data가 복사됐을 것이다.
        // 만약 data의 크기가 엄청 컷다면 그 크기를 그대로 복사해서
        // 메모리적 손해를 볼 수 있는데
        // *** 주소값을 넘기면 8바이트만 넘겨서 값을 처리할 수 있는 것이다! ***
        fmt.Println(data)
        // 또한 함수 내에서 지역변수를 처리 했음에도
        // *** 밖에 있는 변수가 바뀐다!! ***
    }
    ```
- 구조체 포인터의 초기화

  - code

    ```go
    var data Data
    var p *Data = &data

    var p2 *Data = &Data{}
    ```
- instance(인스턴스): 메모리에 할당된 데이터의 실체
  - 포인터는, 어떠한 인스턴스가 만들어지고 포인터는 그 인스턴스를 가르키고 있는 것이다.
  - ***`어떤 포인터 p를 만들고 다른 포인터들을 만들 때 p를 복사한다면 데이터 인스턴스는 하나만 생성되는 것이다.`***
  - ***`하지만 변수를 생성할 때는 복사를 해도 다 다른 인스턴스가 생성된다!`***
  - 객체가 생성, 즉 인스턴스가 생성된다는 것은 lifecycle 이 시작되어서 메모리에 올라가 있는 거고 lifecycle 이 끝나면 그 인스턴스는 메모리에서 사라져서 죽는거다.
  - 그럼 이녀석은 언제 사라져?
    - 아무도 찾지 않을 때 사라진다!
    - 아무도 안쓴다면 다음 garbage collect 에서 사라진다.
- new()내장함수
  - code
    ```go
    p := &Data{}// 이렇게 초기화 할때는 {} 안에 초기화를 세세하게 결정 가능
    var p = new(Data)// 이거는 기본 초기화만 가능
    ```
- Escape Analysis
  - 예를 들어 지역함수 내에 변수가 있고 그 변수를 리턴한다면?
    - 일반적으로 스택에 들어간다면 그 변수는 지역함수의 {}가 끝날 때, 죽을 것이다
    - 결국 리턴을 해서 지역 함수를 사용한 곳에서 변수에 리턴값을 넣어준다고 해도 이미 없는 값을 넣어주는 거니 오류 생긴다.
    - 따라서 이런 경우 리턴값으로 함수 밖으로 무언가 빼줘야할 경우 Heap 영역에 넣는다.
    - ***`stack: func이 끝나면 사라지는 녀석들의 모임`***
    - ***`Heap: 프로그램 전체에서 사용하는 영역으로 쓰임이 있는한 사라지지 않는다.`***